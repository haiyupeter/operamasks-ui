(function(e,f){var c="om-dialog om-widget om-widget-content om-corner-all ",b={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},d={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},a=e.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};e.widget("om.omDialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",collision:"fit",using:function(h){var g=e(this).css(h).offset().top;if(g<0){e(this).css("top",h.top-g)}}},resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");if(typeof this.originalTitle!=="string"){this.originalTitle=""}this.options.title=this.options.title||this.originalTitle;var o=this,p=o.options,m=p.title||"&#160;",h=e.om.omDialog.getTitleId(o.element),n=(o.uiDialog=e("<div></div>")).appendTo(document.body).hide().addClass(c+p.dialogClass).css({zIndex:p.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(q){if(p.closeOnEscape&&q.keyCode&&q.keyCode===e.ui.keyCode.ESCAPE){o.close(q);q.preventDefault()}}).attr({role:"dialog","aria-labelledby":h}).mousedown(function(q){o.moveToTop(false,q)}),j=o.element.show().removeAttr("title").addClass("om-dialog-content om-widget-content").appendTo(n),i=(o.uiDialogTitlebar=e("<div></div>")).addClass("om-dialog-titlebar om-widget-header om-corner-all om-helper-clearfix").prependTo(n),l=e('<a href="#"></a>').addClass("om-dialog-titlebar-close om-corner-all").attr("role","button").hover(function(){l.addClass("om-state-hover")},function(){l.removeClass("om-state-hover")}).focus(function(){l.addClass("om-state-focus")}).blur(function(){l.removeClass("om-state-focus")}).click(function(q){o.close(q);return false}).appendTo(i),k=(o.uiDialogTitlebarCloseText=e("<span></span>")).addClass("om-icon om-icon-closethick").text(p.closeText).appendTo(l),g=e("<span></span>").addClass("om-dialog-title").attr("id",h).html(m).prependTo(i);i.find("*").add(i).disableSelection();if(p.draggable&&e.fn.draggable){o._makeDraggable()}if(p.resizable&&e.fn.resizable){o._makeResizable()}o._createButtons(p.buttons);o._isOpen=false;if(e.fn.bgiframe){n.bgiframe()}},_init:function(){if(this.options.autoOpen){this.open()}},destroy:function(){var g=this;if(g.overlay){g.overlay.destroy()}g.uiDialog.hide();g.element.unbind(".dialog").removeData("dialog").removeClass("om-dialog-content om-widget-content").hide().appendTo("body");g.uiDialog.remove();if(g.originalTitle){g.element.attr("title",g.originalTitle)}return g},widget:function(){return this.uiDialog},close:function(m){var i=this,l,k,j=this.options,g=j.onBeforeClose,h=j.onClose;if(g&&false===g(m)){return}if(i.overlay){i.overlay.destroy()}i.uiDialog.unbind("keypress.om-dialog");i._isOpen=false;if(i.options.hide){i.uiDialog.hide(i.options.hide,function(){h&&h(m)})}else{i.uiDialog.hide();h&&h(m)}e.om.omDialog.overlay.resize();if(i.options.modal){l=0;e(".om-dialog").each(function(){if(this!==i.uiDialog[0]){k=e(this).css("z-index");if(!isNaN(k)){l=Math.max(l,k)}}});e.om.omDialog.maxZ=l}return i},isOpen:function(){return this._isOpen},moveToTop:function(k,j){var g=this,i=g.options,h;if((i.modal&&!k)||(!i.stack&&!i.modal)){return g._trigger("onFocus",j)}if(i.zIndex>e.om.omDialog.maxZ){e.om.omDialog.maxZ=i.zIndex}if(g.overlay){e.om.omDialog.maxZ+=1;g.overlay.$el.css("z-index",e.om.omDialog.overlay.maxZ=e.om.omDialog.maxZ)}h={scrollTop:g.element.scrollTop(),scrollLeft:g.element.scrollLeft()};e.om.omDialog.maxZ+=1;g.uiDialog.css("z-index",e.om.omDialog.maxZ);g.element.attr(h);g._trigger("onFocus",j);return g},open:function(){if(this._isOpen){return}var i=this,j=i.options,h=i.uiDialog;i.overlay=j.modal?new e.om.omDialog.overlay(i):null;i._size();i._position(j.position);h.show(j.show);i.moveToTop(true);if(j.modal){h.bind("keypress.om-dialog",function(m){if(m.keyCode!==e.ui.keyCode.TAB){return}var l=e(":tabbable",this),n=l.filter(":first"),k=l.filter(":last");if(m.target===k[0]&&!m.shiftKey){n.focus(1);return false}else{if(m.target===n[0]&&m.shiftKey){k.focus(1);return false}}})}e(i.element.find(":tabbable").get().concat(h.find(".om-dialog-buttonpane :tabbable").get().concat(h.get()))).eq(0).focus();i._isOpen=true;var g=j.onOpen;if(g){g()}return i},_createButtons:function(j){var i=this,g=false,h=e("<div></div>").addClass("om-dialog-buttonpane om-widget-content om-helper-clearfix"),k=e("<div></div>").addClass("om-dialog-buttonset").appendTo(h);i.uiDialog.find(".om-dialog-buttonpane").remove();if(typeof j==="object"&&j!==null){e.each(j,function(){return !(g=true)})}if(g){e.each(j,function(l,n){n=e.isFunction(n)?{click:n,text:l}:n;var m=e('<button type="button"></button>').click(function(){n.click.apply(i.element[0],arguments)}).appendTo(k);e.each(n,function(o,p){if(o==="click"){return}if(o in a){m[o](p)}else{m.attr(o,p)}});if(e.fn.omButton){m.omButton()}});h.appendTo(i.uiDialog)}},_makeDraggable:function(){var g=this,j=g.options,k=e(document),i;function h(l){return{position:l.position,offset:l.offset}}g.uiDialog.draggable({cancel:".om-dialog-content, .om-dialog-titlebar-close",handle:".om-dialog-titlebar",containment:"document",start:function(l,m){i=j.height==="auto"?"auto":e(this).height();e(this).height(e(this).height()).addClass("om-dialog-dragging");g._trigger("onDragStart",l,h(m))},drag:function(l,m){g._trigger("onDrag",l,h(m))},stop:function(l,m){j.position=[m.position.left-k.scrollLeft(),m.position.top-k.scrollTop()];e(this).removeClass("om-dialog-dragging").height(i);g._trigger("onDragStop",l,h(m));e.om.omDialog.overlay.resize()}})},_makeResizable:function(l){l=(l===f?this.options.resizable:l);var h=this,k=h.options,g=h.uiDialog.css("position"),j=(typeof l==="string"?l:"n,e,s,w,se,sw,ne,nw");function i(m){return{originalPosition:m.originalPosition,originalSize:m.originalSize,position:m.position,size:m.size}}h.uiDialog.resizable({cancel:".om-dialog-content",containment:"document",alsoResize:h.element,maxWidth:k.maxWidth,maxHeight:k.maxHeight,minWidth:k.minWidth,minHeight:h._minHeight(),handles:j,start:function(m,n){e(this).addClass("om-dialog-resizing");h._trigger("onResizeStart",m,i(n))},resize:function(m,n){h._trigger("onResize",m,i(n))},stop:function(m,n){e(this).removeClass("om-dialog-resizing");k.height=e(this).height();k.width=e(this).width();h._trigger("onResizeStop",m,i(n));e.om.omDialog.overlay.resize()}}).css("position",g).find(".om-resizable-se").addClass("om-icon om-icon-grip-diagonal-se")},_minHeight:function(){var g=this.options;if(g.height==="auto"){return g.minHeight}else{return Math.min(g.minHeight,g.height)}},_position:function(h){var i=[],j=[0,0],g;if(h){if(typeof h==="string"||(typeof h==="object"&&"0" in h)){i=h.split?h.split(" "):[h[0],h[1]];if(i.length===1){i[1]=i[0]}e.each(["left","top"],function(l,k){if(+i[l]===i[l]){j[l]=i[l];i[l]=k}});h={my:i.join(" "),at:i.join(" "),offset:j.join(" ")}}h=e.extend({},e.om.omDialog.prototype.options.position,h)}else{h=e.om.omDialog.prototype.options.position}g=this.uiDialog.is(":visible");if(!g){this.uiDialog.show()}this.uiDialog.css({top:0,left:0}).position(e.extend({of:window},h));if(!g){this.uiDialog.hide()}},_setOptions:function(j){var h=this,g={},i=false;e.each(j,function(k,l){h._setOption(k,l);if(k in b){i=true}if(k in d){g[k]=l}});if(i){this._size()}if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",g)}},_setOption:function(j,k){var h=this,g=h.uiDialog;switch(j){case"buttons":h._createButtons(k);break;case"closeText":h.uiDialogTitlebarCloseText.text(""+k);break;case"dialogClass":g.removeClass(h.options.dialogClass).addClass(c+k);break;case"disabled":if(k){g.addClass("om-dialog-disabled")}else{g.removeClass("om-dialog-disabled")}break;case"draggable":var i=g.is(":data(draggable)");if(i&&!k){g.draggable("destroy")}if(!i&&k){h._makeDraggable()}break;case"position":h._position(k);break;case"resizable":var l=g.is(":data(resizable)");if(l&&!k){g.resizable("destroy")}if(l&&typeof k==="string"){g.resizable("option","handles",k)}if(!l&&k!==false){h._makeResizable(k)}break;case"title":e(".om-dialog-title",h.uiDialogTitlebar).html(""+(k||"&#160;"));break}e.Widget.prototype._setOption.apply(h,arguments)},_size:function(){var k=this.options,h,j,g=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0});if(k.minWidth>k.width){k.width=k.minWidth}h=this.uiDialog.css({height:"auto",width:k.width}).height();j=Math.max(0,k.minHeight-h);if(k.height==="auto"){if(e.support.minHeight){this.element.css({minHeight:j,height:"auto"})}else{this.uiDialog.show();var i=this.element.css("height","auto").height();if(!g){this.uiDialog.hide()}this.element.height(Math.max(i,j))}}else{this.element.height(Math.max(k.height-h,0))}if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight())}}});e.extend(e.om.omDialog,{version:"0.1",uuid:0,maxZ:0,getTitleId:function(g){var h=g.attr("id");if(!h){this.uuid+=1;h=this.uuid}return"ui-dialog-title-"+h},overlay:function(g){this.$el=e.om.omDialog.overlay.create(g)}});e.extend(e.om.omDialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(g){return g+".dialog-overlay"}).join(" "),create:function(h){if(this.instances.length===0){setTimeout(function(){if(e.om.omDialog.overlay.instances.length){e(document).bind(e.om.omDialog.overlay.events,function(i){if(e(i.target).zIndex()<e.om.omDialog.overlay.maxZ){return false}})}},1);e(document).bind("keydown.dialog-overlay",function(i){if(h.options.closeOnEscape&&i.keyCode&&i.keyCode===e.ui.keyCode.ESCAPE){h.close(i);i.preventDefault()}});e(window).bind("resize.dialog-overlay",e.om.omDialog.overlay.resize)}var g=(this.oldInstances.pop()||e("<div></div>").addClass("om-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});if(e.fn.bgiframe){g.bgiframe()}this.instances.push(g);return g},destroy:function(g){var h=e.inArray(g,this.instances);if(h!=-1){this.oldInstances.push(this.instances.splice(h,1)[0])}if(this.instances.length===0){e([document,window]).unbind(".dialog-overlay")}g.remove();var i=0;e.each(this.instances,function(){i=Math.max(i,this.css("z-index"))});this.maxZ=i},height:function(){var h,g;if(e.browser.msie&&e.browser.version<7){h=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);g=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(h<g){return e(window).height()+"px"}else{return h+"px"}}else{return e(document).height()+"px"}},width:function(){var g,h;if(e.browser.msie){g=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);h=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(g<h){return e(window).width()+"px"}else{return g+"px"}}else{return e(document).width()+"px"}},resize:function(){var g=e([]);e.each(e.om.omDialog.overlay.instances,function(){g=g.add(this)});g.css({width:0,height:0}).css({width:e.om.omDialog.overlay.width(),height:e.om.omDialog.overlay.height()})}});e.extend(e.om.omDialog.overlay.prototype,{destroy:function(){e.om.omDialog.overlay.destroy(this.$el)}})}(jQuery));